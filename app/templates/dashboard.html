{% extends "base.html" %}

{% block title %}Dashboard - Sistema Avanzado de Lenguaje de Se√±as{% endblock %}

{% block head %}
{{ super() }}
<style>
    :root {
        --primary: #6c63ff;
        --secondary: #4a44c6;
        --success: #2ecc71;
        --danger: #e74c3c;
        --warning: #f39c12;
        --info: #3498db;
        --dark: #1a1a2e;
        --darker: #16213e;
        --light: #f8f9fa;
        --gray: #6c757d;
    }
    
    .dashboard-container {
        max-width: 1600px;
        margin: 0 auto;
        padding: 0 15px;
    }
    
    /* Particles Background */
    #particles-js {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: -1;
    }
    
    /* Header Styles */
    .dashboard-header {
        background: rgba(26, 26, 46, 0.8);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(108, 99, 255, 0.3);
        padding: 1.5rem 0;
        margin-bottom: 1.5rem;
    }
    
    .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .brand {
        display: flex;
        align-items: center;
        gap: 1rem;
    }
    
    .brand-icon {
        width: 60px;
        height: 60px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border-radius: 15px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.8rem;
        box-shadow: 0 4px 15px rgba(108, 99, 255, 0.4);
    }
    
    .brand-text h1 {
        font-size: 1.8rem;
        margin: 0;
        font-weight: 700;
        background: linear-gradient(90deg, var(--primary), #a29bfe);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .brand-text p {
        margin: 0;
        color: var(--gray);
        font-size: 0.9rem;
    }
    
    /* Navigation Tabs */
    .nav-tabs-container {
        margin-bottom: 2rem;
    }
    
    .nav-tabs {
        border-bottom: 1px solid rgba(108, 99, 255, 0.2);
        gap: 0.5rem;
    }
    
    .nav-tabs .nav-link {
        color: var(--gray);
        border: none;
        border-radius: 10px 10px 0 0;
        padding: 0.8rem 1.5rem;
        font-weight: 500;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .nav-tabs .nav-link:hover {
        color: var(--light);
        background: rgba(108, 99, 255, 0.1);
    }
    
    .nav-tabs .nav-link.active {
        color: var(--primary);
        background: rgba(108, 99, 255, 0.15);
        border-bottom: 3px solid var(--primary);
    }
    
    .tab-icon {
        font-size: 1.1rem;
    }
    
    /* Main Content */
    .main-content {
        margin-bottom: 2rem;
    }
    
    /* Section Headers */
    .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .section-title {
        font-size: 1.5rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0;
    }
    
    /* Card Styles */
    .card {
        background: rgba(26, 26, 46, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(108, 99, 255, 0.2);
        border-radius: 15px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        margin-bottom: 1.5rem;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.3);
    }
    
    .card-header {
        background: rgba(22, 33, 62, 0.8);
        border-bottom: 1px solid rgba(108, 99, 255, 0.2);
        border-radius: 15px 15px 0 0 !important;
        padding: 1rem 1.5rem;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .card-title {
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .card-body {
        padding: 1.5rem;
    }
    
    /* Video Container - MEJORADO */
    .video-container {
        position: relative;
        width: 100%;
        height: 400px; /* Aumentado para mejor visibilidad */
        border-radius: 15px;
        overflow: hidden;
        background: var(--darker);
        border: 2px solid rgba(108, 99, 255, 0.3);
        transition: all 0.3s ease;
    }
    
    /* Efecto RGB cuando est√° activo el reconocimiento */
    .video-container.recognition-active {
        border: 2px solid transparent;
        animation: rgb-border 2s linear infinite;
        box-shadow: 0 0 20px rgba(108, 99, 255, 0.5);
    }
    
    @keyframes rgb-border {
        0% { border-color: #ff0000; }
        25% { border-color: #00ff00; }
        50% { border-color: #0000ff; }
        75% { border-color: #ffff00; }
        100% { border-color: #ff0000; }
    }
    
    .video-player {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(22, 33, 62, 0.9);
        z-index: 10;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
    }
    
    /* Chat Styles */
    .chat-container {
        height: 400px;
        display: flex;
        flex-direction: column;
    }
    
    .chat-box {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        background: rgba(22, 33, 62, 0.5);
        border-radius: 10px;
        margin-bottom: 1rem;
    }
    
    .msg {
        display: flex;
        margin-bottom: 1rem;
    }
    
    .msg.user {
        justify-content: flex-end;
    }
    
    .msg.bot {
        justify-content: flex-start;
    }
    
    .avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        margin: 0 0.5rem;
    }
    
    .bubble {
        max-width: 70%;
        padding: 0.8rem 1rem;
        border-radius: 15px;
        word-wrap: break-word;
    }
    
    .bubble.user {
        background: var(--primary);
        color: white;
        border-bottom-right-radius: 5px;
    }
    
    .bubble.bot {
        background: rgba(255, 255, 255, 0.1);
        color: var(--light);
        border-bottom-left-radius: 5px;
    }
    
    /* Recording Stats */
    .recording-stats {
        display: flex;
        justify-content: space-around;
        text-align: center;
    }
    
    .recording-stat {
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    
    .recording-stat .value {
        font-size: 1.5rem;
        font-weight: 700;
    }
    
    .recording-stat .label {
        font-size: 0.8rem;
        color: var(--gray);
    }
    
    /* Quick Stats */
    .quick-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .quick-stat {
        background: rgba(26, 26, 46, 0.7);
        border-radius: 15px;
        padding: 1.5rem;
        text-align: center;
        border: 1px solid rgba(108, 99, 255, 0.2);
        transition: transform 0.3s ease;
    }
    
    .quick-stat:hover {
        transform: translateY(-5px);
    }
    
    .quick-stat .number {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        background: linear-gradient(90deg, var(--primary), #a29bfe);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    
    .quick-stat .label {
        color: var(--gray);
        font-size: 0.9rem;
    }
    
    /* Status Indicators */
    .status-indicator {
        display: inline-block;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        margin-right: 5px;
    }
    
    .status-active {
        background-color: var(--success);
        box-shadow: 0 0 10px var(--success);
    }
    
    .status-inactive {
        background-color: var(--gray);
    }
    
    /* Cooldown Indicator */
    .cooldown-indicator {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.9rem;
    }
    
    .cooldown-progress {
        width: 60px;
        height: 6px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 3px;
        overflow: hidden;
    }
    
    .cooldown-progress-bar {
        height: 100%;
        background: var(--warning);
        transition: width 1s linear;
    }
    
    /* Metric Cards */
    .metric-card {
        background: rgba(22, 33, 62, 0.5);
        border-radius: 10px;
        padding: 1rem;
        text-align: center;
        margin-bottom: 1rem;
    }
    
    .metric-value {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: var(--primary);
    }
    
    .metric-label {
        font-size: 0.9rem;
        color: var(--gray);
    }
    
    /* Form Controls */
    .form-control, .form-select {
        background: rgba(22, 33, 62, 0.7);
        border: 1px solid rgba(108, 99, 255, 0.3);
        color: var(--light);
        border-radius: 10px;
    }
    
    .form-control:focus, .form-select:focus {
        background: rgba(22, 33, 62, 0.9);
        border-color: var(--primary);
        box-shadow: 0 0 0 0.25rem rgba(108, 99, 255, 0.25);
        color: var(--light);
    }
    
    /* Buttons */
    .btn {
        border-radius: 10px;
        font-weight: 500;
        transition: all 0.3s ease;
        padding: 0.5rem 1rem;
    }
    
    .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        border: none;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(108, 99, 255, 0.4);
    }
    
    /* Table Styles */
    .table-dark {
        background: rgba(22, 33, 62, 0.7);
        border-radius: 10px;
        overflow: hidden;
    }
    
    .table-dark thead th {
        background: rgba(26, 26, 46, 0.9);
        border-bottom: 1px solid rgba(108, 99, 255, 0.3);
        font-weight: 600;
    }
    
    .table-dark tbody tr:hover {
        background: rgba(108, 99, 255, 0.1);
    }
    
    /* Progress Bars */
    .progress {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 5px;
        height: 6px;
    }
    
    .progress-bar {
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        border-radius: 5px;
    }
    
    /* Badges */
    .badge {
        border-radius: 10px;
        font-weight: 500;
        padding: 0.4rem 0.8rem;
    }
    
    /* Microphone Button */
    .mic-btn {
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .mic-btn.listening {
        animation: pulse 1.5s infinite;
        background: var(--danger) !important;
    }
    
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.1); }
        100% { transform: scale(1); }
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
        .header-content {
            flex-direction: column;
            text-align: center;
            gap: 1rem;
        }
        
        .brand {
            justify-content: center;
        }
        
        .nav-tabs .nav-link {
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
        }
        
        .section-header {
            flex-direction: column;
            align-items: flex-start;
            gap: 1rem;
        }
        
        .quick-stats {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .video-container {
            height: 300px;
        }
    }
    
    @media (max-width: 576px) {
        .quick-stats {
            grid-template-columns: 1fr;
        }
        
        .recording-stats {
            flex-direction: column;
            gap: 1rem;
        }
        
        .video-container {
            height: 250px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Particles Background -->
    <div id="particles-js"></div>

    <!-- Header -->
    <div class="dashboard-header">
        <div class="header-content">
            <div class="brand">
                <div class="brand-icon">
                    <i class="fas fa-hands"></i>
                </div>
                <div class="brand-text">
                    <h1>Sistema Avanzado de Lenguaje de Se√±as</h1>
                    <p>Reconocimiento inteligente en tiempo real con IA</p>
                </div>
            </div>
            <div class="header-stats">
                <span class="badge bg-primary fs-6">v2.0</span>
            </div>
        </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs-container">
        <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="conversation-tab" data-bs-toggle="tab" data-bs-target="#conversation" type="button" role="tab">
                    <i class="fas fa-comments tab-icon"></i>
                    Modo Conversaci√≥n
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="recognition-tab" data-bs-toggle="tab" data-bs-target="#recognition" type="button" role="tab">
                    <i class="fas fa-brain tab-icon"></i>
                    Reconocimiento en Tiempo Real
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="gestures-tab" data-bs-toggle="tab" data-bs-target="#gestures" type="button" role="tab">
                    <i class="fas fa-video tab-icon"></i>
                    Gestos y Biblioteca
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="stats-tab" data-bs-toggle="tab" data-bs-target="#stats" type="button" role="tab">
                    <i class="fas fa-chart-bar tab-icon"></i>
                    Estad√≠sticas
                </button>
            </li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="tab-content" id="dashboardTabContent">
            
            <!-- Modo Conversaci√≥n -->
            <div class="tab-pane fade show active" id="conversation" role="tabpanel">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-comments text-info"></i>
                        Modo Conversaci√≥n Inteligente
                    </h2>
                    <div class="section-actions">
                        <span class="badge bg-info fs-6">
                            <i class="fas fa-robot me-1"></i>IA Activa
                        </span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="fas fa-robot text-info"></i>
                                    Chat de Gestos
                                </h5>
                                <span class="badge bg-success">En l√≠nea</span>
                            </div>
                            <div class="card-body">
                                <div class="chat-container">
                                    <div class="chat-box" id="chatBox">
                                        <div class="msg bot">
                                            <div class="avatar">ü§ñ</div>
                                            <div class="bubble bot">
                                                ¬°Hola! Soy tu asistente de lenguaje de se√±as. 
                                                Escribe o di lo que quieres comunicar y te mostrar√© los gestos correspondientes.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="chat-input d-flex gap-2">
                                        <input type="text" class="form-control" id="convInput" placeholder="Escribe tu mensaje o usa el micr√≥fono...">
                                        <button class="btn btn-outline-secondary mic-btn" id="micBtn" title="Usar micr√≥fono">
                                            <i class="fas fa-microphone"></i>
                                        </button>
                                        <button class="btn btn-primary" id="convSendBtn">
                                            <i class="fas fa-paper-plane"></i> Enviar
                                        </button>
                                    </div>
                                    <div class="mt-2 text-center">
                                        <small class="text-muted" id="recognitionStatus">Micr√≥fono listo</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="fas fa-play-circle text-success"></i>
                                    Reproductor de Gestos
                                </h5>
                                <span class="badge bg-success" id="playerStatus">En espera</span>
                            </div>
                            <div class="card-body">
                                <div id="nowPlaying">
                                    <div class="alert alert-info">
                                        <i class="fas fa-info-circle me-2"></i>
                                        <span class="fw-semibold">Selecciona un gesto para reproducir</span>
                                    </div>
                                </div>
                                <div id="player" class="video-container" style="display: none;"></div>
                                <div class="d-grid gap-2 mt-3">
                                    <button class="btn btn-outline-danger" id="stopQueueBtn">
                                        <i class="fas fa-stop"></i> Detener Reproducci√≥n
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reconocimiento en Tiempo Real -->
            <div class="tab-pane fade" id="recognition" role="tabpanel">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-brain text-success"></i>
                        Reconocimiento en Tiempo Real
                    </h2>
                    <div class="section-actions">
                        <span class="badge bg-secondary" id="recStatus">
                            <span class="status-indicator status-inactive"></span> Inactivo
                        </span>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="fas fa-camera text-success"></i>
                                    C√°mara de Reconocimiento
                                </h5>
                                <div class="cooldown-indicator">
                                    <span>Cooldown:</span>
                                    <div class="cooldown-progress">
                                        <div class="cooldown-progress-bar" id="cooldownProgress" style="width: 0%"></div>
                                    </div>
                                    <span id="cooldownText">3s</span>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="video-container" id="recVideoContainer">
                                    <video id="recVideo" class="video-player" autoplay muted playsinline></video>
                                    <div class="overlay text-center" id="recOverlay">
                                        <div class="m-auto">
                                            <i class="fas fa-camera fa-3x mb-3 text-muted"></i>
                                            <p class="text-muted">C√°mara de reconocimiento</p>
                                            <button class="btn btn-primary" id="startRecBtn">
                                                <i class="fas fa-play me-2"></i>Iniciar Reconocimiento
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="d-grid gap-2 mt-3">
                                    <button class="btn btn-success" id="startRecBtn">
                                        <i class="fas fa-play me-2"></i>Iniciar Reconocimiento
                                    </button>
                                    <button class="btn btn-danger" id="stopRecBtn" disabled>
                                        <i class="fas fa-stop me-2"></i>Detener Reconocimiento
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="fas fa-chart-line text-warning"></i>
                                    Resultados en Tiempo Real
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="recResult" style="min-height: 200px;">
                                    <div class="d-flex align-items-center justify-content-center h-100">
                                        <div class="text-center text-muted">
                                            <i class="fas fa-brain fa-2x mb-2"></i>
                                            <p class="mb-0">Sistema en espera</p>
                                            <small>Inicia el reconocimiento para comenzar</small>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <h6 class="text-muted mb-2">Landmarks Detectados:</h6>
                                    <div id="landmarksInfo" class="mb-3">
                                        <span class="text-muted">No landmarks</span>
                                    </div>
                                </div>
                                <div class="mt-3">
                                    <h6 class="text-muted mb-2">Vista en Tiempo Real:</h6>
                                    <div class="video-container">
                                        <img id="realTimePreview" class="video-player" style="object-fit: contain;" alt="Vista en tiempo real">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gestos y Biblioteca -->
            <div class="tab-pane fade" id="gestures" role="tabpanel">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-video text-warning"></i>
                        Gestos y Biblioteca
                    </h2>
                    <div class="section-actions">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newGestureModal">
                            <i class="fas fa-plus me-2"></i>Nuevo Gesto
                        </button>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="fas fa-record-vinyl text-warning"></i>
                                    Grabar Nuevo Gesto
                                </h5>
                                <span class="badge bg-secondary" id="recordingStatus">Listo</span>
                            </div>
                            <div class="card-body">
                                <div class="recording-section">
                                    <div class="recording-camera">
                                        <div class="video-container">
                                            <video id="recorderPreview" class="video-player" autoplay muted playsinline></video>
                                            <div class="overlay text-center" id="recorderOverlay">
                                                <div class="m-auto">
                                                    <i class="fas fa-video fa-3x mb-3 text-muted"></i>
                                                    <p class="text-muted">C√°mara de grabaci√≥n</p>
                                                    <button class="btn btn-primary" id="startRecordBtn">
                                                        <i class="fas fa-record-vinyl me-2"></i>Iniciar Grabaci√≥n
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="recording-stats mt-3">
                                            <div class="recording-stat">
                                                <span class="value" id="frameCount">0</span>
                                                <span class="label">Frames</span>
                                            </div>
                                            <div class="recording-stat">
                                                <span class="value" id="recordingTime">00:00</span>
                                                <span class="label">Tiempo</span>
                                            </div>
                                            <div class="recording-stat">
                                                <span class="value text-secondary" id="recordingIndicator">‚óè</span>
                                                <span class="label">Estado</span>
                                            </div>
                                        </div>
                                        <div class="progress mt-2 mb-3">
                                            <div id="recordingProgress" class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <div class="d-grid gap-2 mt-3">
                                            <button class="btn btn-warning" id="startRecordBtn">
                                                <i class="fas fa-record-vinyl me-2"></i>Iniciar Grabaci√≥n
                                            </button>
                                            <button class="btn btn-danger" id="stopRecordBtn" disabled>
                                                <i class="fas fa-stop me-2"></i>Detener Grabaci√≥n
                                            </button>
                                        </div>
                                    </div>
                                    <div class="recording-form mt-4">
                                        <form id="gestureForm">
                                            <div class="mb-3">
                                                <label for="gestureName" class="form-label">Nombre del Gesto</label>
                                                <input type="text" class="form-control" id="gestureName" required placeholder="Ej: Hola, Gracias, Ayuda">
                                            </div>
                                            <div class="mb-3">
                                                <label for="gestureCategory" class="form-label">Categor√≠a</label>
                                                <select class="form-select" id="gestureCategory" required>
                                                    <option value="saludos">Saludos</option>
                                                    <option value="comunes">Comunes</option>
                                                    <option value="emergencia">Emergencia</option>
                                                    <option value="personalizado">Personalizado</option>
                                                </select>
                                            </div>
                                            <div class="mb-3">
                                                <label for="gestureDesc" class="form-label">Descripci√≥n</label>
                                                <textarea class="form-control" id="gestureDesc" rows="3" placeholder="Describe el gesto..."></textarea>
                                            </div>
                                            <div class="d-grid gap-2">
                                                <button type="submit" class="btn btn-success" id="saveRecordBtn" disabled>
                                                    <i class="fas fa-save me-2"></i>Guardar Gesto
                                                </button>
                                                <button type="button" class="btn btn-outline-secondary" id="resetFormBtn">
                                                    <i class="fas fa-undo me-2"></i>Limpiar Formulario
                                                </button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="fas fa-book text-info"></i>
                                    Biblioteca de Gestos
                                </h5>
                                <button class="btn btn-sm btn-outline-primary" id="refreshList">
                                    <i class="fas fa-sync-alt"></i>
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-dark table-hover">
                                        <thead>
                                            <tr>
                                                <th>Nombre</th>
                                                <th>Categor√≠a</th>
                                                <th>Frames</th>
                                                <th>Calidad</th>
                                                <th>Fecha</th>
                                                <th>Acciones</th>
                                            </tr>
                                        </thead>
                                        <tbody id="gesturesTable">
                                            <tr>
                                                <td colspan="6" class="text-center py-5">
                                                    <div class="text-muted">
                                                        <i class="fas fa-inbox fa-3x mb-3"></i>
                                                        <h5>No hay gestos registrados</h5>
                                                        <p class="mb-0">Comienza grabando tu primer gesto</p>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estad√≠sticas -->
            <div class="tab-pane fade" id="stats" role="tabpanel">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar text-purple"></i>
                        Estad√≠sticas del Sistema
                    </h2>
                    <div class="section-actions">
                        <span class="badge bg-purple">Actualizado en tiempo real</span>
                    </div>
                </div>

                <div class="quick-stats">
                    <div class="quick-stat">
                        <div class="number" id="totalGestures">0</div>
                        <div class="label">Gestos Totales</div>
                    </div>
                    <div class="quick-stat">
                        <div class="number" id="totalFrames">0</div>
                        <div class="label">Frames Procesados</div>
                    </div>
                    <div class="quick-stat">
                        <div class="number" id="totalDuration">0s</div>
                        <div class="label">Duraci√≥n Total</div>
                    </div>
                    <div class="quick-stat">
                        <div class="number" id="accuracyRate">95%</div>
                        <div class="label">Tasa de Precisi√≥n</div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="fas fa-chart-pie text-info"></i>
                                    Distribuci√≥n por Categor√≠a
                                </h5>
                            </div>
                            <div class="card-body">
                                <div id="categoryDistribution">
                                    <div class="text-center text-muted py-4">
                                        <i class="fas fa-chart-pie fa-3x mb-3"></i>
                                        <p>No hay datos suficientes para mostrar</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card">
                            <div class="card-header">
                                <h5 class="card-title">
                                    <i class="fas fa-tachometer-alt text-success"></i>
                                    Rendimiento del Sistema
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="metric-card mb-3">
                                    <div class="metric-value">98.5%</div>
                                    <div class="metric-label">Disponibilidad</div>
                                </div>
                                <div class="metric-card mb-3">
                                    <div class="metric-value">45ms</div>
                                    <div class="metric-label">Latencia Promedio</div>
                                </div>
                                <div class="metric-card">
                                    <div class="metric-value">12 FPS</div>
                                    <div class="metric-label">Procesamiento</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Alert Container para notificaciones -->
<div id="alertContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 11"></div>
<div id="toastContainer" class="position-fixed top-0 end-0 p-3" style="z-index: 11"></div>
{% endblock %}

{% block scripts %}
{{ super() }}
<!-- Particles.js -->
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
    // Inicializar part√≠culas
    document.addEventListener('DOMContentLoaded', function() {
        particlesJS('particles-js', {
            particles: {
                number: { value: 80, density: { enable: true, value_area: 800 } },
                color: { value: "#6c63ff" },
                shape: { type: "circle" },
                opacity: { value: 0.5, random: true },
                size: { value: 3, random: true },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#6c63ff",
                    opacity: 0.4,
                    width: 1
                },
                move: {
                    enable: true,
                    speed: 2,
                    direction: "none",
                    random: true,
                    straight: false,
                    out_mode: "out",
                    bounce: false
                }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: true, mode: "repulse" },
                    onclick: { enable: true, mode: "push" }
                }
            }
        });
    });
</script>

<!-- Gestures Script -->
<script src="{{ url_for('static', filename='js/gestures.js') }}"></script>

<script>
    // Inicializar AOS animations
    AOS.init({
        duration: 800,
        once: true,
        offset: 100
    });

    // Sistema de reconocimiento de voz
    let recognition = null;
    let isListening = false;
    
    // Verificar compatibilidad con Web Speech API
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'es-ES';
        
        recognition.onstart = function() {
            isListening = true;
            document.getElementById('micBtn').classList.add('listening');
            document.getElementById('recognitionStatus').textContent = "Escuchando...";
            document.getElementById('recognitionStatus').className = "text-warning";
        };
        
        recognition.onresult = function(event) {
            const transcript = event.results[0][0].transcript;
            document.getElementById('convInput').value = transcript;
            isListening = false;
            document.getElementById('micBtn').classList.remove('listening');
            document.getElementById('recognitionStatus').textContent = "Texto reconocido";
            document.getElementById('recognitionStatus').className = "text-success";
            
            // Enviar autom√°ticamente despu√©s de reconocer
            setTimeout(() => {
                if (typeof sendConversationMessage === 'function') {
                    sendConversationMessage();
                }
            }, 500);
        };
        
        recognition.onerror = function(event) {
            console.error('Error en reconocimiento de voz:', event.error);
            isListening = false;
            document.getElementById('micBtn').classList.remove('listening');
            document.getElementById('recognitionStatus').textContent = "Error en micr√≥fono";
            document.getElementById('recognitionStatus').className = "text-danger";
        };
        
        recognition.onend = function() {
            isListening = false;
            document.getElementById('micBtn').classList.remove('listening');
            document.getElementById('recognitionStatus').textContent = "Micr√≥fono listo";
            document.getElementById('recognitionStatus').className = "text-muted";
        };
    } else {
        document.getElementById('micBtn').style.display = 'none';
        document.getElementById('recognitionStatus').textContent = "Micr√≥fono no compatible";
        document.getElementById('recognitionStatus').className = "text-danger";
    }
    
    // Control del micr√≥fono
    document.getElementById('micBtn').addEventListener('click', function() {
        if (!recognition) return;
        
        if (isListening) {
            recognition.stop();
        } else {
            recognition.start();
        }
    });

    // Inicializar el sistema cuando el DOM est√© listo
    document.addEventListener('DOMContentLoaded', function() {
        console.log('üöÄ Dashboard profesional inicializado');
        
        // Forzar la recarga de gestos al cambiar a la pesta√±a de biblioteca
        document.getElementById('gestures-tab').addEventListener('click', function() {
            setTimeout(() => {
                if (typeof loadGesturesList === 'function') {
                    loadGesturesList();
                }
            }, 100);
        });
        
        // Forzar la recarga de estad√≠sticas
        document.getElementById('stats-tab').addEventListener('click', function() {
            setTimeout(() => {
                if (typeof loadStats === 'function') {
                    loadStats();
                }
            }, 100);
        });
        
        // Mejorar la funci√≥n de b√∫squeda en conversaci√≥n
        if (typeof sendConversationMessage === 'function') {
            const originalSendConversationMessage = sendConversationMessage;
            window.sendConversationMessage = async function() {
                const input = document.getElementById("convInput");
                const message = input ? input.value.trim() : '';
                
                if (!message) {
                    ModalManager.showWarning("Campo Vac√≠o", "Por favor escribe un mensaje");
                    return;
                }

                // Agregar mensaje del usuario al chat
                addChatMessage("user", message);
                if (input) input.value = "";

                const loadingModal = ModalManager.showLoading("Buscando gestos...");

                try {
                    // Usar b√∫squeda en la lista de gestos existente
                    const gesturesResult = await GesturesAPI.getGesturesList();
                    
                    ModalManager.hideLoading();
                    
                    if (gesturesResult.success && gesturesResult.gestures) {
                        const matchingGestures = gesturesResult.gestures.filter(gesture => 
                            gesture.name.toLowerCase().includes(message.toLowerCase()) ||
                            (gesture.description && gesture.description.toLowerCase().includes(message.toLowerCase()))
                        );
                        
                        if (matchingGestures.length > 0) {
                            let response = `Encontr√© ${matchingGestures.length} gesto(s) relacionados con "<strong>${message}</strong>":<br><br>`;
                            
                            matchingGestures.forEach(gesture => {
                                response += `‚Ä¢ <strong>${gesture.name}</strong>`;
                                if (gesture.description) {
                                    response += ` - ${gesture.description}`;
                                }
                                response += ` <button class="btn btn-sm btn-outline-primary ms-2" onclick="playGesture('${gesture.video_path || ''}', '${gesture.name}')">
                                    <i class="fas fa-play"></i> Ver
                                </button><br>`;
                            });
                            
                            addChatMessage("bot", response);
                            
                            // Reproducir autom√°ticamente el primer resultado
                            if (matchingGestures.length > 0 && matchingGestures[0].video_path) {
                                setTimeout(() => {
                                    playGesture(matchingGestures[0].video_path, matchingGestures[0].name);
                                }, 500);
                            }
                            
                            // Sintetizar voz para el primer resultado
                            if (matchingGestures.length > 0) {
                                const ttsResult = await GesturesAPI.textToSpeech(`Encontr√© el gesto ${matchingGestures[0].name}`);
                                if (ttsResult.success && ttsResult.audio_data) {
                                    playAudio(ttsResult.audio_data);
                                }
                            }
                        } else {
                            addChatMessage("bot", `No encontr√© gestos relacionados con "<strong>${message}</strong>". Intenta con otras palabras.`);
                        }
                    } else {
                        addChatMessage("bot", `Error buscando gestos: ${gesturesResult.error}`);
                    }
                    
                } catch (error) {
                    ModalManager.hideLoading();
                    addChatMessage("bot", `Error buscando gestos para "${message}". Intenta nuevamente.`);
                }
            };
        }
    });
</script>
{% endblock %}